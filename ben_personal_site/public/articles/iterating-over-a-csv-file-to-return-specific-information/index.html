<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ben McLaren</title>
  
  
  <link rel="stylesheet" href="/css/main.min.css">
  <link href="https://fonts.googleapis.com/css?family=Rubik:400,500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="shortcut icon" href="blogo1.ico" type="image/x-icon">
  <meta property="og:image" content="https://res.cloudinary.com/dy35n8sog/image/upload/v1578389845/Screenshot_2020-01-07_at_09.36.47_ehi2dt.png">
  <link rel="shortcut icon" href="https://res.cloudinary.com/dy35n8sog/image/upload/v1578391731/blogo1_guumr5.ico" type="image/x-icon">
</head>
<body>

<header class="header">
  <div class="nav">
    <a class="name" href="/index.html">Ben McLaren</a>
    <a class="link" href="/articles">Articles</a>
  </div>
</header>





<article class="page">
  <div class="page-content">
    <p class="page-title"> Iterating over a CSV file to return specific information </p>
  <p>For this challenge we want to implement a <code>most_successful</code> method that returns the movies (a certain number passed as a parameter) published prior to a given year and with their associated earnings. The returned list should be an array of movies. Each movie should be represented by a hash with keys: name, year and earnings. Ex: <code>{ name: &quot;Avatar&quot;, year: 2009, earnings: 760505847 }</code></p>
<p>We have been given a CSV file containing the data that we need.</p>
<p>We need to put <code>require 'csv'</code> at the top of file. This makes Ruby’s CSV library available to your program so that you can then use the class <code>CSV</code>.</p>
<p>We start by writing a method that will allow us to access the data from the csv file.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e"></span><span style="color:#f92672"></span><span style="color:#a6e22e">load_movies</span>(file_path, max_year)
  movies <span style="color:#f92672">=</span> <span style="color:#f92672">[</span><span style="color:#f92672">]</span>

  <span style="color:#66d9ef">CSV</span><span style="color:#f92672">.</span>foreach(file_path) <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>row<span style="color:#f92672">|</span>
    year <span style="color:#f92672">=</span> row<span style="color:#f92672">[</span><span style="color:#ae81ff">1</span><span style="color:#f92672"></span><span style="color:#f92672">]</span><span style="color:#f92672">.</span>to_i
    <span style="color:#66d9ef">next</span> <span style="color:#66d9ef">if</span> year <span style="color:#f92672">&gt;</span><span style="color:#f92672">=</span> max_year

    movies <span style="color:#f92672">&lt;&lt;</span> { name: row<span style="color:#f92672">[</span><span style="color:#ae81ff">0</span><span style="color:#f92672"></span><span style="color:#f92672">]</span>, <span style="color:#e6db74">year</span>: year, <span style="color:#e6db74">earnings</span>: row<span style="color:#f92672">[</span><span style="color:#ae81ff">2</span><span style="color:#f92672"></span><span style="color:#f92672">]</span><span style="color:#f92672">.</span>to_i }
  <span style="color:#66d9ef">end</span>

  movies
<span style="color:#66d9ef">end</span>
</code></pre></div><ol>
<li>
<p>Our method <code>load_movies</code> takes two parameters of <code>file_path</code> and <code>max_year</code></p>
</li>
<li>
<p>We begin by initialising an empty array which we will use to store our data. Here we have called it <code>movies</code>.</p>
</li>
<li>
<p>Next, we can use the class <code>CSV</code> and use a <code>.foreach</code> loop which we pass <code>file_path</code> as an argument. This will iterate over each row in the csv file.</p>
</li>
<li></li>
</ol>
<ul>
<li>
<p>Inside our block we are creating a new variable called <code>year</code>. This is equal to targetting the row and specifically the element in the 2nd position (<code>row[1]</code>) which is our year. We then call <code>.to_i</code> on this to transform it from a string to an integer.</p>
</li>
<li>
<p>We then have a <code>next if</code> statement. This simply means move on and skip this iteration if this condition is not met. The condition we give it is if the <code>year</code> is greater than or equal to the <code>max_year</code>.</p>
</li>
<li>
<p>The last thing to do in this block is append this data into our currently empty <code>movies</code> array. We can do this by giving the csv file some headers which will make it easier to read and access data from. This is what this everything inside these brackets means <code>{}</code>. We have <code>name: row[0]</code> which means that the element in the first position in the row is called name. We have <code>year: year</code> which is equal to our variable of year which we created earlier. Finaly we have <code>earnings: row[2].to_i</code> which is equal to the element in the final position in the row converted to an integer.</p>
</li>
</ul>
<ol start="5">
<li>To finish off we simply return <code>movies</code>.</li>
</ol>
<p>Now that we have written a method to get all this data we can write our method that will actually do something with it. Here, we have a method that takes three arguments. The <code>number</code>, <code>max_year</code> and <code>file_path</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e"></span><span style="color:#f92672"></span><span style="color:#a6e22e">most_successful</span>(number, max_year, file_path)
  all_movies <span style="color:#f92672">=</span> load_movies(file_path, max_year)
  all_movies<span style="color:#f92672">.</span>max_by(number) { <span style="color:#f92672">|</span>movie<span style="color:#f92672">|</span> movie<span style="color:#f92672">[</span><span style="color:#e6db74">:earnings</span><span style="color:#f92672">]</span> }
<span style="color:#66d9ef">end</span>
</code></pre></div><ol>
<li>
<p>We start by creating a new variable called <code>all_movies</code>. This is equal to calling the <code>load_movies</code> method with its required arguments.</p>
</li>
<li>
<p>We can now use the method <code>.max_by</code>. This method will return the the object with the maximum value that is specified in the block. We say for every <code>movie</code> grab the earnings using the notation <code>movie[:earnings]</code>.</p>
</li>
</ol>

</article>

</div>


  <section class="footer">
    <div class="footer-container">
      <p class="contact">
        Feel free to get in contact
      </p>
      <div class="icons">
        <a href="https://github.com/benmclaren" target="_blank">
          <i class="fa fa-github"></i>
        </a>

        <a href="mailto:bmclaren01@gmail.com" target="_blank">
          <i class="fa fa-paper-plane"></i>
        </a>

        <a href="https://twitter.com/bybenmclaren" target="_blank">
          <i class="fa fa-twitter"></i>
        </a>

        <a href="https://www.linkedin.com/in/ben-mclaren/" target="_blank">
          <i class="fa fa-linkedin"></i>
        </a>

      </div>
      <p>
        ©benmclaren2020
      </p>
    </div>
  </section>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/cloudinary-core/2.3.0/cloudinary-core-shrinkwrap.min.js">
  </script>
  <script>
    var cl = cloudinary.Cloudinary.new({
      cloud_name: 'dy35n8sog'
    });

    cl.responsive()
  </script>

</body>
</html>

